{"version":3,"file":"index.js","sources":["../src/DetailsAccordionElement.ts","../src/index.ts"],"sourcesContent":["function assert(cond: boolean): asserts cond is true {}\n\nexport default class DetailsAccordionElement extends HTMLElement {\n\t/**\n\t * @internal\n\t */\n\tprivate _animationDuration: number = 0;\n\n\t/**\n\t * @internal\n\t */\n\tprivate _elements: HTMLDetailsElement[] = [];\n\n\t/**\n\t * @internal\n\t */\n\tprivate _animations: Animation[] = [];\n\n\t/**\n\t * @internal\n\t */\n\tprivate _animationFinished: Promise<Animation | void> = Promise.resolve();\n\n\t/**\n\t * @internal\n\t */\n\tprivate _currentElement?: HTMLDetailsElement;\n\n\tstatic get observedAttributes(): string[] {\n\t\treturn [\"animation-duration\"];\n\t}\n\n\tget animationDuration(): number {\n\t\treturn this._animationDuration;\n\t}\n\n\tset animationDuration(value: number) {\n\t\tif (!Number.isNaN(value) || value !== 0) {\n\t\t\tthis.setAttribute(\"animation-duration\", value.toString());\n\t\t} else {\n\t\t\tthis.removeAttribute(\"animation-duration\");\n\t\t}\n\t}\n\n\tget animationFinished(): Promise<Animation | void> {\n\t\treturn this._animationFinished;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\t// Create shadow root\n\t\tconst shadowRoot = this.attachShadow({ mode: \"open\" });\n\t\tshadowRoot.innerHTML = `<style>::slotted(details){overflow-y:hidden}</style><slot></slot>`;\n\t\tshadowRoot.addEventListener(\n\t\t\t\"slotchange\",\n\t\t\tthis._handleSlotChange.bind(this)\n\t\t);\n\n\t\t// Observe click events\n\t\tthis.addEventListener(\"click\", this._handleClick.bind(this));\n\t}\n\n\tattributeChangedCallback(\n\t\tname: string,\n\t\t_oldValue: string | undefined,\n\t\tnewValue: string | undefined\n\t): void {\n\t\tif (name === \"animation-duration\") {\n\t\t\tthis._animationDuration = newValue != null ? parseInt(newValue) : 0;\n\t\t}\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _handleSlotChange(e: Event): void {\n\t\tconst target = e.target as HTMLSlotElement;\n\n\t\t// Clear elements\n\t\tthis._elements = [];\n\n\t\tconst assignedElements = target.assignedElements();\n\t\tconst assignedElementsLength = assignedElements.length;\n\t\tfor (let i = 0; i < assignedElementsLength; i++) {\n\t\t\tconst assignedElement = assignedElements[i];\n\n\t\t\tif (assignedElement instanceof HTMLDetailsElement) {\n\t\t\t\t// Close details if it's not meant to be open\n\t\t\t\tassignedElement.open = assignedElement === this._currentElement;\n\n\t\t\t\t// Clear data attributes\n\t\t\t\tdelete assignedElement.dataset.detailsAccordionAnimating;\n\t\t\t\tdelete assignedElement.dataset.detailsAccordionOpen;\n\n\t\t\t\t// Add to array\n\t\t\t\tthis._elements.push(assignedElement);\n\t\t\t}\n\t\t}\n\n\t\t// Cancel animations\n\t\tconst animationsLength = this._animations.length;\n\t\tfor (let i = 0; i < animationsLength; i++) {\n\t\t\tconst animation = this._animations[i];\n\n\t\t\tif (animation !== undefined) {\n\t\t\t\tanimation.cancel();\n\t\t\t}\n\t\t}\n\n\t\t// Clear animations\n\t\tthis._animations = new Array(this._elements.length);\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _handleClick(e: MouseEvent): boolean {\n\t\tconst target = e.target as HTMLElement;\n\n\t\tif (target === null || target.tagName !== \"SUMMARY\") {\n\t\t\t// We don't care about other click events\n\t\t\treturn true;\n\t\t}\n\n\t\tconst details = target.parentElement! as HTMLDetailsElement;\n\n\t\tif (details.parentElement !== this) {\n\t\t\t// We only care about top-level details\n\t\t\treturn true;\n\t\t}\n\n\t\te.preventDefault();\n\n\t\tif (details !== this._currentElement) {\n\t\t\tif (this._currentElement !== undefined) {\n\t\t\t\tthis._closeElement(this._currentElement);\n\t\t\t\tdelete this._currentElement.dataset.detailsAccordionOpen;\n\t\t\t}\n\n\t\t\tthis._openElement(details);\n\t\t\tthis._currentElement = details;\n\t\t\tthis._currentElement.dataset.detailsAccordionOpen = \"\";\n\t\t} else if (this._currentElement !== undefined) {\n\t\t\tthis._closeElement(this._currentElement);\n\t\t\tdelete this._currentElement.dataset.detailsAccordionOpen;\n\n\t\t\tthis._currentElement = undefined;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _animate(element: HTMLDetailsElement, callback: () => void): void {\n\t\tconst index = this._elements?.findIndex((e) => e === element);\n\t\tassert(index !== -1);\n\n\t\tconst startHeight = element.offsetHeight;\n\t\telement.open = true;\n\t\telement.dataset.detailsAccordionAnimating = \"\";\n\n\t\t// If there is already an animation running\n\t\tif (this._animations[index] !== undefined) {\n\t\t\t// Cancel the current animation\n\t\t\tthis._animations[index].cancel();\n\t\t}\n\n\t\tlet endHeight;\n\n\t\tif (element.dataset.detailsAccordionOpen === undefined) {\n\t\t\t// Opening\n\t\t\tconst rect = element.getBoundingClientRect();\n\t\t\tendHeight = rect.height;\n\t\t} else {\n\t\t\t// Closing\n\t\t\tendHeight = element.querySelector(\"summary\")!.offsetHeight;\n\t\t}\n\n\t\t// Animate `details` height\n\t\tthis._animations[index] = element.animate(\n\t\t\t{\n\t\t\t\theight: [`${startHeight}px`, `${endHeight}px`],\n\t\t\t},\n\t\t\t{\n\t\t\t\tduration: this._animationDuration,\n\t\t\t\teasing: \"ease-out\",\n\t\t\t}\n\t\t);\n\n\t\t// Construct promise\n\t\tlet animationResolve: (value: Animation) => void = () => {};\n\t\tthis._animationFinished = new Promise((resolve) => {\n\t\t\tanimationResolve = resolve;\n\t\t});\n\n\t\tthis._animations[index].onfinish = () => {\n\t\t\tcallback();\n\t\t\tanimationResolve(this._animations[index]);\n\t\t};\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _openElement(element: HTMLDetailsElement): void {\n\t\tthis._animate(element, () => {\n\t\t\tdelete element.dataset.detailsAccordionAnimating;\n\t\t});\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _closeElement(element: HTMLDetailsElement): void {\n\t\tthis._animate(element, () => {\n\t\t\telement.open = false;\n\t\t\tdelete element.dataset.detailsAccordionAnimating;\n\t\t});\n\t}\n}\n","import DetailsAccordionElement from \"./DetailsAccordionElement\";\n\nexport default DetailsAccordionElement;\n\nconsole.log(window.customElements.get(\"details-accordion\"))\n\nif (window.customElements.get(\"details-accordion\") === undefined) {\n\twindow.customElements.define(\"details-accordion\", DetailsAccordionElement);\n}\n"],"names":["assert","cond","__name","DetailsAccordionElement","_animationDuration","_elements","_animations","_animationFinished","shadowRoot","_handleSlotChange","_handleClick","value","name","_oldValue","newValue","e","target","assignedElements","assignedElementsLength","i","assignedElement","_currentElement","animationsLength","animation","details","_closeElement","_openElement","_animate","element","callback","_a","index","startHeight","endHeight","animationResolve","resolve"],"mappings":"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"}