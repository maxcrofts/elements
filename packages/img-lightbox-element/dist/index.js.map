{"version":3,"file":"index.js","sources":["../src/ImgLightboxElement.ts","../src/index.ts"],"sourcesContent":["import css from \"./ImgLightboxElement.css\";\nimport innerHTML from \"./ImgLightboxElement.html\";\n\nconst cssStyleSheet = new CSSStyleSheet();\ncssStyleSheet.replaceSync(css);\n\nconst templateElement = document.createElement(\"template\");\ntemplateElement.innerHTML = innerHTML;\n\nexport default class ImgLightboxElement extends HTMLElement {\n\t/**\n\t * @internal\n\t */\n\tprivate readonly _dialogElement: HTMLDialogElement;\n\n\t/**\n\t * @internal\n\t */\n\tprivate readonly _imgElement: HTMLImageElement;\n\n\t/**\n\t * @internal\n\t */\n\tprivate readonly _currentSpanElement: HTMLSpanElement;\n\n\t/**\n\t * @internal\n\t */\n\tprivate readonly _totalSpanElement: HTMLSpanElement;\n\n\t/**\n\t * @internal\n\t */\n\tprivate _selectedElements: HTMLElement[] = [];\n\n\t/**\n\t * @internal\n\t */\n\tprivate _selectors: string = \"img\";\n\n\t/**\n\t * @internal\n\t */\n\tprivate _currentIndex: number = 0;\n\n\tstatic get observedAttributes(): string[] {\n\t\treturn [\"selectors\"];\n\t}\n\n\tget selectors(): string {\n\t\treturn this._selectors;\n\t}\n\n\tset selectors(value: any) {\n\t\tif (value != null) {\n\t\t\tthis.setAttribute(\"selectors\", value.toString());\n\t\t} else {\n\t\t\tthis.removeAttribute(\"selectors\");\n\t\t}\n\t}\n\n\tget currentIndex(): number {\n\t\treturn this._currentIndex;\n\t}\n\n\tset currentIndex(value: number) {\n\t\tconst length = this._selectedElements.length;\n\t\t// Proper modulo (ensures index is positive)\n\t\tthis._currentIndex = ((value % length) + length) % length;\n\n\t\tconst selectedElement = this._selectedElements[this._currentIndex];\n\n\t\tthis._imgElement.removeAttribute(\"srcset\");\n\t\tthis._imgElement.removeAttribute(\"src\");\n\t\tthis._imgElement.removeAttribute(\"alt\");\n\n\t\tif (selectedElement.hasAttribute(\"srcset\")) {\n\t\t\tthis._imgElement.setAttribute(\n\t\t\t\t\"srcset\",\n\t\t\t\tselectedElement.getAttribute(\"srcset\")\n\t\t\t);\n\t\t}\n\n\t\tif (selectedElement.hasAttribute(\"src\")) {\n\t\t\tthis._imgElement.setAttribute(\n\t\t\t\t\"src\",\n\t\t\t\tselectedElement.getAttribute(\"src\")\n\t\t\t);\n\t\t}\n\n\t\tif (selectedElement.hasAttribute(\"alt\")) {\n\t\t\tthis._imgElement.setAttribute(\n\t\t\t\t\"alt\",\n\t\t\t\tselectedElement.getAttribute(\"alt\")\n\t\t\t);\n\t\t}\n\n\t\tthis._currentSpanElement.innerText = (\n\t\t\tthis._currentIndex + 1\n\t\t).toString();\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst shadowRoot = this.attachShadow({ mode: \"open\" });\n\t\tshadowRoot.adoptedStyleSheets = [cssStyleSheet];\n\n\t\tconst node = templateElement.content.cloneNode(true);\n\t\tshadowRoot.appendChild(node);\n\n\t\tconst slotElement = shadowRoot.querySelector(\"slot\")!;\n\t\tslotElement.addEventListener(\n\t\t\t\"slotchange\",\n\t\t\tthis._handleSlotChange.bind(this)\n\t\t);\n\n\t\tthis._dialogElement = shadowRoot.querySelector(\"dialog\")!;\n\t\tthis._dialogElement.addEventListener(\n\t\t\t\"click\",\n\t\t\tthis._handleClick.bind(this)\n\t\t);\n\n\t\tthis._imgElement = shadowRoot.querySelector(\"img\")!;\n\n\t\tconst previousButtonElement =\n\t\t\tshadowRoot.querySelector(\"[part*=previous]\")!;\n\t\tpreviousButtonElement.addEventListener(\n\t\t\t\"click\",\n\t\t\tthis._handlePrevious.bind(this)\n\t\t);\n\t\tconst nextButtonElement = shadowRoot.querySelector(\"[part*=next]\")!;\n\t\tnextButtonElement.addEventListener(\n\t\t\t\"click\",\n\t\t\tthis._handleNext.bind(this)\n\t\t);\n\n\t\tthis._currentSpanElement = shadowRoot.querySelector(\"#current\")!;\n\t\tthis._totalSpanElement = shadowRoot.querySelector(\"#total\")!;\n\n\t\tthis.addEventListener(\"click\", this._handleOpen.bind(this));\n\t}\n\n\tattributeChangedCallback(\n\t\tname: string,\n\t\t_oldValue: string | undefined,\n\t\tnewValue: string | undefined\n\t): void {\n\t\tif (name === \"selectors\") {\n\t\t\tthis._selectors = newValue ?? \"img\";\n\t\t}\n\n\t\tthis._update();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _handleSlotChange(e: any): void {\n\t\tthis._update();\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _handleOpen(e: MouseEvent): void {\n\t\tconst index = [].findIndex.call(this._selectedElements, (element) => {\n\t\t\treturn element === e.target;\n\t\t});\n\n\t\tif (index !== -1) {\n\t\t\te.preventDefault();\n\n\t\t\t// Show dialog\n\t\t\tthis._dialogElement.showModal();\n\n\t\t\t// Update image\n\t\t\tthis.currentIndex = index;\n\t\t}\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _handlePrevious(_: any): void {\n\t\tthis.currentIndex--;\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _handleNext(_: any): void {\n\t\tthis.currentIndex++;\n\t}\n\n\t/// https://stackoverflow.com/a/57463812\n\t/**\n\t * @internal\n\t */\n\tprivate _handleClick(e: MouseEvent): void {\n\t\tconst target = e.target as HTMLDialogElement;\n\n\t\tif (target.tagName !== \"DIALOG\") {\n\t\t\treturn;\n\t\t}\n\n\t\tconst rect = target.getBoundingClientRect();\n\n\t\tconst clickedInDialog =\n\t\t\trect.top <= e.clientY &&\n\t\t\te.clientY <= rect.top + rect.height &&\n\t\t\trect.left <= e.clientX &&\n\t\t\te.clientX <= rect.left + rect.width;\n\n\t\tif (!clickedInDialog) {\n\t\t\ttarget.close();\n\t\t}\n\t}\n\n\t/**\n\t * @internal\n\t */\n\tprivate _update(): void {\n\t\tthis._selectedElements = Array.from(\n\t\t\tthis.querySelectorAll(this._selectors)\n\t\t);\n\t\tthis._totalSpanElement.innerText =\n\t\t\tthis._selectedElements.length.toString();\n\t}\n}\n","import ImgLightboxElement from \"./ImgLightboxElement\";\n\nexport default ImgLightboxElement;\n\nif (window.customElements.get(\"img-lightbox\") !== undefined) {\n\twindow.customElements.define(\"img-lightbox\", ImgLightboxElement);\n}\n"],"names":["cssStyleSheet","css","templateElement","innerHTML","ImgLightboxElement","_selectedElements","_selectors","_currentIndex","shadowRoot","node","_handleSlotChange","_dialogElement","_handleClick","_imgElement","_handlePrevious","_handleNext","_currentSpanElement","_totalSpanElement","_handleOpen","value","length","selectedElement","name","_oldValue","newValue","_update","e","index","element","_","target","rect","__name"],"mappings":"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"}