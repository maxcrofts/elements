{"version":3,"file":"QuerySelectorElement.spec.js","sources":["../src/QuerySelectorElement.spec.ts"],"sourcesContent":["/// <reference types=\"@types/chai\" />\n/// <reference types=\"@types/mocha\" />\n\nimport type QuerySelectorElement from \"./QuerySelectorElement\";\n\ndeclare const assert: Chai.AssertStatic;\n\ndescribe(\"query-selector\", () => {\n\tit(\"selects nothing by default\", async () => {\n\t\tdocument.body.innerHTML = `\n\t\t\t<query-selector>\n\t\t\t\t<div class=\"foo\"></div>\n\t\t\t\t<div class=\"bar\"></div>\n\t\t\t</query-selector>\n\t\t`;\n\n\t\tconst querySelectorElement = document.body\n\t\t\t.firstElementChild! as QuerySelectorElement;\n\n\t\tconst selectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\tassert.equal(selectedElements.length, 0);\n\t});\n\n\tit(\"selects correct element based on `selectors` attribute\", async () => {\n\t\tdocument.body.innerHTML = `\n\t\t\t<query-selector selectors=\".yes\">\n\t\t\t\t<div class=\"yes\"></div>\n\t\t\t\t<div class=\"no\"></div>\n\t\t\t</query-selector>\n\t\t`;\n\n\t\tconst querySelectorElement = document.body\n\t\t\t.firstElementChild! as QuerySelectorElement;\n\n\t\tconst selectedElement =\n\t\t\tquerySelectorElement.querySelector(\"[data-selected]\");\n\t\tconst targetElement = querySelectorElement.querySelector(\".yes\");\n\t\tassert.equal(selectedElement, targetElement);\n\t});\n\n\tit(\"selects correct elements based on `selectors` attribute\", async () => {\n\t\tdocument.body.innerHTML = `\n\t\t\t<query-selector selectors=\".yes\">\n\t\t\t\t<div class=\"yes\"></div>\n\t\t\t\t<div class=\"no\"></div>\n\t\t\t\t<div class=\"yes\"></div>\n\t\t\t\t<div class=\"no\"></div>\n\t\t\t</query-selector>\n\t\t`;\n\n\t\tconst querySelectorElement = document.body\n\t\t\t.firstElementChild! as QuerySelectorElement;\n\n\t\tconst selectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\tconst targetElements = querySelectorElement.querySelectorAll(\".yes\");\n\t\tassert.equal(selectedElements.length, targetElements.length);\n\t\tassert.deepEqual(selectedElements, targetElements);\n\t});\n\n\tit(\"selects correct elements based on radio input\", async () => {\n\t\tdocument.body.innerHTML = `\n\t\t\t<query-selector input-name=\"theInput\">\n\t\t\t\t<form>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\tname=\"theInput\"\n\t\t\t\t\t\tvalue=\".a\"\n\t\t\t\t\t\tchecked\n\t\t\t\t\t/>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\tname=\"theInput\"\n\t\t\t\t\t\tvalue=\".b\"\n\t\t\t\t\t/>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\tname=\"theInput\"\n\t\t\t\t\t\tvalue=\".c\"\n\t\t\t\t\t/>\n\t\t\t\t</form>\n\n\t\t\t\t<div class=\"a\"></div>\n\t\t\t\t<div class=\"b\"></div>\n\t\t\t\t<div class=\"a\"></div>\n\t\t\t\t<div class=\"b\"></div>\n\t\t\t\t<div class=\"a\"></div>\n\t\t\t</query-selector>\n\t\t`;\n\n\t\tconst querySelectorElement = document.body\n\t\t\t.firstElementChild! as QuerySelectorElement;\n\n\t\tconst aRadioElement =\n\t\t\tquerySelectorElement.querySelector<HTMLInputElement>(\n\t\t\t\t\"input[value=\\\\.a]\"\n\t\t\t)!;\n\t\tconst bRadioElement =\n\t\t\tquerySelectorElement.querySelector<HTMLInputElement>(\n\t\t\t\t\"input[value=\\\\.b]\"\n\t\t\t)!;\n\t\tconst cRadioElement =\n\t\t\tquerySelectorElement.querySelector<HTMLInputElement>(\n\t\t\t\t\"input[value=\\\\.c]\"\n\t\t\t)!;\n\n\t\tlet selectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\tlet targetElements = querySelectorElement.querySelectorAll(\".a\");\n\t\tassert.equal(selectedElements.length, targetElements.length);\n\n\t\tbRadioElement.click();\n\t\tselectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\ttargetElements = querySelectorElement.querySelectorAll(\".b\");\n\t\tassert.equal(selectedElements.length, targetElements.length);\n\n\t\tcRadioElement.click();\n\t\tselectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\ttargetElements = querySelectorElement.querySelectorAll(\".c\");\n\t\tassert.equal(selectedElements.length, targetElements.length);\n\n\t\taRadioElement.click();\n\t\tselectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\ttargetElements = querySelectorElement.querySelectorAll(\".a\");\n\t\tassert.equal(selectedElements.length, targetElements.length);\n\t});\n\n\tit(\"applies `data-selected` attribute when child elements are added\", async () => {\n\t\tdocument.body.innerHTML = `\n\t\t\t<div>\n\t\t\t\t<query-selector selectors=\".yes\">\n\t\t\t\t\t<div class=\"yes\"></div>\n\t\t\t\t\t<div class=\"no\"></div>\n\t\t\t\t</query-selector>\n\t\t\t\t<div class=\"yes\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst containerElement = document.body\n\t\t\t.firstElementChild! as HTMLDivElement;\n\t\tconst querySelectorElement =\n\t\t\tcontainerElement.querySelector(\"query-selector\")!;\n\t\tconst extraElement = containerElement.querySelector(\":scope > .yes\")!;\n\n\t\t// Check that only `div.yes` has `data-selected` attribute\n\t\tlet selectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\tlet targetElements = querySelectorElement.querySelectorAll(\".yes\");\n\t\tassert.equal(selectedElements.length, 1);\n\t\tassert.equal(selectedElements.length, targetElements.length);\n\t\tassert.deepEqual(selectedElements, targetElements);\n\n\t\t// Check that extra div does not have `data-selected` attribute\n\t\tassert.isFalse(extraElement.hasAttribute(\"data-selected\"));\n\n\t\t// Move extra div into `query-selector`\n\t\tquerySelectorElement.appendChild(extraElement);\n\n\t\t// Wait for next animation frame\n\t\tawait new Promise((resolve) => requestAnimationFrame(resolve));\n\n\t\t// Check that only elements matching `div.yes` have `data-selected` attribute\n\t\tselectedElements =\n\t\t\tquerySelectorElement.querySelectorAll(\"[data-selected]\");\n\t\ttargetElements = querySelectorElement.querySelectorAll(\".yes\");\n\t\tassert.equal(selectedElements.length, 2);\n\t\tassert.equal(selectedElements.length, targetElements.length);\n\t\tassert.deepEqual(selectedElements, targetElements);\n\n\t\t// Check that extra div does now has `data-selected` attribute\n\t\tassert.isTrue(extraElement.hasAttribute(\"data-selected\"));\n\t});\n\n\tit(\"sets `inputName` property based on `input-name` attribute\", async () => {\n\t\tconst querySelector = document.createElement(\n\t\t\t\"query-selector\"\n\t\t) as QuerySelectorElement;\n\t\tconst inputName = \"theInput\";\n\t\tquerySelector.setAttribute(\"input-name\", inputName);\n\t\tassert.equal(querySelector.inputName, inputName);\n\t});\n\n\tit(\"sets `input-name` attribute based on `inputName` property\", async () => {\n\t\tconst querySelector = document.createElement(\n\t\t\t\"query-selector\"\n\t\t) as QuerySelectorElement;\n\t\tconst inputName = \"theInput\";\n\t\tquerySelector.inputName = inputName;\n\t\tassert.equal(querySelector.getAttribute(\"input-name\"), inputName);\n\t});\n\n\tit(\"sets `selectors` property based on `selectors` attribute\", async () => {\n\t\tconst querySelector = document.createElement(\n\t\t\t\"query-selector\"\n\t\t) as QuerySelectorElement;\n\t\tconst selectors = \".aClass\";\n\t\tquerySelector.setAttribute(\"selectors\", selectors);\n\t\tassert.equal(querySelector.selectors, selectors);\n\t});\n\n\tit(\"sets `selectors` attribute based on `selectors` property\", async () => {\n\t\tconst querySelector = document.createElement(\n\t\t\t\"query-selector\"\n\t\t) as QuerySelectorElement;\n\t\tconst selectors = \".aClass\";\n\t\tquerySelector.selectors = selectors;\n\t\tassert.equal(querySelector.getAttribute(\"selectors\"), selectors);\n\t});\n});\n"],"names":["selectedElements","querySelectorElement","selectedElement","targetElement","targetElements","aRadioElement","bRadioElement","cRadioElement","containerElement","extraElement","resolve","querySelector","inputName","selectors"],"mappings":"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"}